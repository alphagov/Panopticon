<% if flash[:notice].present? %>
  <div class="alert alert-success"><%= flash[:notice] %></div>
<% end %>

<% if artefact.errors.count > 0 %>
  <div class="alert alert-error">
    <ul>
      <% artefact.errors.full_messages.each do |message| %>
      <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% if artefact.archived? %>
  <div class="alert alert-error">
    <h2>Stop! You can't edit this artefact because it has been archived.</h2>
  </div>
<% else %>
  <div class="well">
    <%= semantic_form_for(artefact, :html => { :class => '', :id => 'edit_artefact'}) do |f| %>
      <%= f.input :owning_app, :as => :hidden %>
      <%= f.input :state, :as => :hidden, :input_html => { :value => "live" } %>
      <%= f.inputs do %>
        <%= f.input :name, :input_html => { :class => "span6" }, :hint => "A name/title for the item" %>
        <%= f.input :description, :input_html => { :class => "span6", :rows => 6 }, :as => :text %>
        <%= f.input :slug, :input_html => { :class => "span6" }, :hint => "Inside government slugs are: <code>government/the-slug</code>. Detailed guides are simply: <code>the-slug</code>".html_safe %>
        <%= link_to "View on site", published_url(f.object), :rel => 'external', :class => "btn btn-primary" unless f.object.new_record? %>

        <hr>

        <input type="hidden" name="artefact[sections][]" value="" />
        <% if artefact.new_record? %>
          <%= f.input :kind, :collection => Artefact::WHITEHALL_FORMATS.map { |s| [s.humanize, s]}, :as => :select, :class => "span6", :prompt => "Select a kind" %>
        <% end %>

        <label for="artefact[sections][]">Sections</label>
        <p>The first section will be the primary section the content lives in. This will form the content breadcrumb.</p>
        <% if artefact.section_ids.length > 0 %>
          <% artefact.section_ids.each do | section_id | %>
            <%= render :partial => 'artefact_section', :locals => {:section_id => section_id, :tag_collection => tag_collection} %>
          <% end %>
        <% else %>
          <%= render :partial => 'artefact_section', :locals => {:section_id => nil, :tag_collection => tag_collection} %>
        <% end %>

        <button id="add-section" class="btn btn-success" type="button">Add another section</button>
      <% end %>

      <hr>

      <%= f.submit :value => "Save and continue editing", :class => "btn btn-success" %>
    <% end %>
  </div>
<% end %>

<%= content_for :extra_javascript do %>
  <script type="text/javascript">
    if ($('.artefact-section').size() == 1) {
      $('.remove-section').hide();
    }
  </script>
<% end %>
